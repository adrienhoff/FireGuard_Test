System.register(["jimu-core","jimu-arcgis","esri/widgets/Sketch/SketchViewModel","esri/layers/FeatureLayer","esri/layers/GraphicsLayer","esri/Graphic","esri/widgets/FeatureForm"],(function(e,t){var n={},r={},a={},o={},i={},s={},l={};return{setters:[function(e){n.React=e.React},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent},function(e){a.default=e.default},function(e){o.default=e.default},function(e){i.default=e.default},function(e){s.default=e.default},function(e){l.default=e.default}],execute:function(){e((()=>{var e={2089:e=>{"use strict";e.exports=s},5633:e=>{"use strict";e.exports=o},9620:e=>{"use strict";e.exports=i},3387:e=>{"use strict";e.exports=l},624:e=>{"use strict";e.exports=a},2686:e=>{"use strict";e.exports=r},9244:e=>{"use strict";e.exports=n}},t={};function c(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,c),a.exports}c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var d={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(d),c.d(d,{__set_webpack_public_path__:()=>u,default:()=>l});var e=c(9244),t=c(2686),n=c(624),r=c(5633),a=c(9620),o=c(2089),i=c(3387),s=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))};class l extends e.React.PureComponent{constructor(t){super(t),this.myRef=e.React.createRef(),this.cleanupFeatureForm=()=>{this.featureFormRef.current&&(this.featureFormRef.current.destroy(),this.featureFormRef.current=null)},this.handleClose=()=>{this.cleanupFeatureForm(),this.setState({editorVisible:!1,selectedGraphic:null,previewGraphic:null,isDrawingPolygon:!1})},this.handleConfirmPolygon=()=>s(this,void 0,void 0,(function*(){const{previewGraphic:e,selectedLayer:t}=this.state;if(t&&e)try{const n=yield t.applyEdits({addFeatures:[new o.default({geometry:e.geometry,attributes:{}})]});if(n.addFeatureResults.length>0){const e=n.addFeatureResults[0].objectId;if(e){const n=t.createQuery();n.objectIds=[e],n.outFields=["*"],n.returnGeometry=!0;const r=yield t.queryFeatures(n);if(r.features.length>0){const e=r.features[0];console.log("Feature added:",e),yield new Promise((t=>{this.setState({selectedGraphic:e,editorVisible:!0,isSubmitted:!1,previewGraphic:null,isDrawingPolygon:!1},(()=>{setTimeout((()=>{const e=document.querySelector(".feature-form-container");e&&this.launchFeatureFormWidget(e)}),0),t()}))}))}}}this.state.tempGraphicsLayer.removeAll()}catch(e){console.error("Failed to add polygon to the selected layer:",e)}else console.error("No layer selected or no polygon to confirm!")})),this.launchFeatureFormWidget=e=>s(this,void 0,void 0,(function*(){const{jimuMapView:t,selectedGraphic:n}=this.state;if(!e||!t||!n)return void console.error("Missing container, map view, or selected graphic.");this.cleanupFeatureForm(),e.innerHTML="";const a=n.layer;if(!(a instanceof r.default))return void console.error("Selected graphic's layer is not a FeatureLayer.");const o={elements:[{type:"group",label:"Attributes",elements:a.fields.map((e=>({type:"field",fieldName:e.name,label:e.alias||e.name,editable:e.editable})))}]},l=new i.default({container:e,layer:a,feature:n,formTemplate:o});this.featureFormRef.current=l,l.on("submit",(()=>s(this,void 0,void 0,(function*(){if(n)try{const e=l.getValues();Object.keys(e).forEach((t=>{n.attributes[t]=e[t]}));(yield a.applyEdits({updateFeatures:[n]})).updateFeatureResults.length>0?(console.log("Feature updated successfully!"),this.handleClose()):console.error("Failed to update the feature.")}catch(e){console.error("Error applying edits:",e)}else console.error("No feature selected for updating.")}))))})),this.handleLayerSelectionAndDrawing=(e,t)=>{var n;const r=null===(n=this.state.jimuMapView)||void 0===n?void 0:n.view.map.findLayerById(e);r&&this.setState({selectedLayer:r},(()=>{this.initializeSketchViewModel(this.state.jimuMapView.view,t),this.startDrawing(t)}))},this.initializeSketchViewModel=(e,t)=>{e.map.add(this.state.tempGraphicsLayer);const r=e=>{const t=[];return e.forEach((e=>{"group"===e.type?t.push(...r(e.layers)):"feature"===e.type&&t.push(e)})),t},a="polygon"===t?r(e.map.layers):[],o={view:e,layer:this.state.tempGraphicsLayer,updateOnGraphicClick:!1,defaultCreateOptions:{mode:"click",hasZ:!1},snappingOptions:{enabled:!0,distance:15,featureSources:a.map((e=>({layer:e,enabled:!0})))}},i={view:e,layer:this.state.tempGraphicsLayer,updateOnGraphicClick:!1,defaultCreateOptions:{mode:"freehand",hasZ:!1},snappingOptions:null},s=new n.default("polygon"===t?o:i);s.on("create",(e=>{if("complete"===e.state){const t=e.graphic;this.setState({previewGraphic:t})}else"cancel"===e.state?(this.setState({previewGraphic:null,isDrawingPolygon:!1}),this.state.tempGraphicsLayer.removeAll()):"active"===e.state&&this.setState({isDrawingPolygon:!0})})),s.on("update",(e=>{if("complete"===e.state&&e.graphics.length>0){const t=e.graphics[0];this.setState({selectedFeature:t}),console.log("Feature selected:",t)}})),this.setState({sketchViewModel:s})},this.startDrawing=e=>{this.state.sketchViewModel&&(this.setState({isDrawingPolygon:!0}),this.state.tempGraphicsLayer.removeAll(),this.state.sketchViewModel.create("polygon",{mode:e}))},this.startReshape=()=>{const{sketchViewModel:e,tempGraphicsLayer:t}=this.state;if(e)if(t.graphics.length>0){const n=t.graphics.getItemAt(0);e.update([n],{tool:"transform",enableRotation:!0,enableScaling:!0,preserveAspectRatio:!1}),console.log("Editing vertices of the selected graphic.")}else console.warn("No graphics available to edit.");else console.error("SketchViewModel is not initialized.")},this.handleCancelPolygon=()=>{this.state.sketchViewModel&&this.state.sketchViewModel.cancel(),this.state.tempGraphicsLayer&&this.state.tempGraphicsLayer.removeAll(),this.setState({previewGraphic:null,isDrawingPolygon:!1})},this.getFeatureLayers=(e,t)=>{const n=[];return e.forEach((e=>{"group"===e.type?e.title===t&&n.push(...this.getFeatureLayers(e.layers,t)):"feature"!==e.type||"National FireGuard Service"!==e.title&&"FireGuard Reference Points"!==e.title||n.push(e)})),n},this.activeViewChangeHandler=e=>{if(e){const t="Analyst Layers",n=this.getFeatureLayers(e.view.map.layers,t);this.setState({jimuMapView:e,availableLayers:n}),this.initializeSketchViewModel(e.view,"polygon")}},this.handleSelectFeature=e=>{var t;const n=null===(t=this.state.jimuMapView)||void 0===t?void 0:t.view.map.findLayerById(e);if(n&&this.state.jimuMapView){const e=this.state.jimuMapView.view,t=e.on("click",(r=>s(this,void 0,void 0,(function*(){const a={x:r.x,y:r.y};try{const r=(yield e.hitTest(a)).results.find((e=>e.graphic.layer===n));if(r){const n=r.graphic;console.log("Selected feature:",n),this.state.sketchViewModel||this.initializeSketchViewModel(e,"polygon"),this.setState({selectedGraphic:n,editorVisible:!0},(()=>{const e=document.querySelector(".feature-form-container");e&&this.launchFeatureFormWidget(e),this.state.sketchViewModel&&this.state.sketchViewModel.update([n],{tool:"reshape"})})),t.remove()}}catch(e){console.error("Error selecting feature:",e)}}))))}},this.getLayerSymbol=e=>{var t,n;if(!e)return null;try{const r=e.renderer;let a;if("simple"===r.type?a=r.symbol:"unique-value"===r.type&&(a=r.defaultSymbol||r.uniqueValueInfos[0]&&r.uniqueValueInfos[0].symbol),a&&"simple-fill"===a.type)return{fillColor:a.color?`rgba(${a.color.r}, ${a.color.g}, ${a.color.b}, ${a.color.a})`:"rgba(0, 0, 0, 0.3)",outlineColor:(null===(t=a.outline)||void 0===t?void 0:t.color)?`rgba(${a.outline.color.r}, ${a.outline.color.g}, ${a.outline.color.b}, ${a.outline.color.a})`:"#000",outlineWidth:(null===(n=a.outline)||void 0===n?void 0:n.width)||1}}catch(e){console.error("Error getting layer symbol:",e)}return null},this.featureFormRef=e.React.createRef(),this.state={jimuMapView:null,sketchViewModel:null,selectedLayer:null,availableLayers:[],previewGraphic:null,tempGraphicsLayer:new a.default,isDrawingPolygon:!1,editorVisible:!1,selectedGraphic:null}}render(){var n;let r=e.React.createElement("p",null,"Please select a map.");const{availableLayers:a,previewGraphic:o,editorVisible:i,isDrawingPolygon:s}=this.state;return this.props.hasOwnProperty("useMapWidgetIds")&&(null===(n=this.props.useMapWidgetIds)||void 0===n?void 0:n[0])&&(r=e.React.createElement(t.JimuMapViewComponent,{useMapWidgetId:this.props.useMapWidgetIds[0],onActiveViewChange:this.activeViewChangeHandler})),e.React.createElement("div",{className:"widget-js-api-editor",style:{height:"100%",overflow:"auto"}},e.React.createElement("div",{className:"layer-buttons"},a.map((t=>{const n=this.getLayerSymbol(t);return e.React.createElement("div",{key:t.id,className:"layer-option"},e.React.createElement("div",{className:"layer-header"},n&&e.React.createElement("div",{className:"layer-symbol",style:{backgroundColor:n.fillColor,border:`${n.outlineWidth}px solid ${n.outlineColor}`}}),e.React.createElement("h3",{className:"layer-title"},t.title)),e.React.createElement("button",{className:"button-base button-primary",onClick:()=>this.handleLayerSelectionAndDrawing(t.id,"polygon")},"Draw Polygon (Snapping)"),e.React.createElement("button",{className:"button-base button-primary",onClick:()=>this.handleLayerSelectionAndDrawing(t.id,"freehand")},"Draw Freehand Polygon"),e.React.createElement("button",{onClick:()=>this.handleSelectFeature(t.id),style:{padding:"8px 16px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"4px",marginLeft:"10px"}},"Select Feature"))}))),o&&e.React.createElement("div",{className:"preview-controls"},e.React.createElement("button",{onClick:this.startReshape,className:"button-base button-secondary"},"Reshape"),e.React.createElement("button",{onClick:this.handleConfirmPolygon,className:"button-base button-success"},"Confirm"),e.React.createElement("button",{onClick:this.handleCancelPolygon,className:"button-base button-danger"},"Cancel Polygon")),i&&e.React.createElement("div",{className:"editor-container"},e.React.createElement("div",{className:"feature-form-container"}),e.React.createElement("div",{className:"button-container"},e.React.createElement("button",{onClick:this.startReshape,style:{padding:"8px 16px",backgroundColor:"#f0f0f0",border:"1px solid #ccc",borderRadius:"4px"}},"Reshape"),e.React.createElement("button",{onClick:this.handleClose,style:{padding:"8px 16px",backgroundColor:"#f0f0f0",border:"1px solid #ccc",borderRadius:"4px"}},"Close"),e.React.createElement("button",{onClick:()=>{const e=this.featureFormRef.current;e&&e.submit()},style:{padding:"8px 16px",backgroundColor:"#0066cc",color:"white",border:"none",borderRadius:"4px"}},"Submit Changes"))),e.React.createElement("div",{ref:this.myRef},e.React.createElement("style",null,"\n      .layer-buttons {\n        display: flex;\n        flex-direction: column;\n        gap: 1rem;\n        padding: 1rem;\n        max-width: 800px;\n        margin: 0 auto;\n      }\n      \n      .layer-option {\n        background: white;\n        padding: 1.5rem;\n        border-radius: 0.5rem;\n        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n        display: flex;\n        align-items: center;\n        gap: 1.5rem;\n        flex-wrap: wrap;\n      }\n      \n      .layer-header {\n        display: flex;\n        align-items: center;\n        gap: 1rem;\n        flex: 1;\n        min-width: 200px;\n      }\n      \n      .layer-symbol {\n        width: 20px;\n        height: 20px;\n        border-radius: 4px;\n      }\n      \n      .layer-title {\n        font-size: 1.25rem;\n        font-weight: 600;\n        color: #1f2937;\n        margin: 0;\n      }\n\n           \n      .button-base {\n        padding: 0.75rem 1.25rem;\n        border-radius: 0.375rem;\n        font-weight: 500;\n        transition: all 0.2s;\n        outline: none;\n        border: none;\n        display: flex;\n        align-items: center;\n        gap: 0.5rem;\n      }\n      \n      .button-base:focus {\n        box-shadow: 0 0 0 2px #e5e7eb, 0 0 0 4px #3b82f6;\n      }\n      \n      .button-base:active {\n        transform: scale(0.98);\n      }\n      \n      .button-primary {\n        background-color: #3b82f6;\n        color: white;\n      }\n      \n      .button-primary:hover {\n        background-color: #2563eb;\n      }\n      \n      .button-primary:active {\n        background-color: #1d4ed8;\n        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);\n      }\n      \n      .button-success {\n        background-color: #10b981;\n        color: white;\n      }\n      \n      .button-success:hover {\n        background-color: #059669;\n      }\n      \n      .button-success:active {\n        background-color: #047857;\n        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);\n      }\n      \n      .button-secondary {\n        background-color: #f3f4f6;\n        color: #374151;\n        border: 1px solid #e5e7eb;\n      }\n      \n      .button-secondary:hover {\n        background-color: #e5e7eb;\n      }\n      \n      .button-secondary:active {\n        background-color: #d1d5db;\n        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);\n      }\n      \n      .button-danger {\n        background-color: #ef4444;\n        color: white;\n      }\n      \n      .button-danger:hover {\n        background-color: #dc2626;\n      }\n      \n      .button-danger:active {\n        background-color: #b91c1c;\n        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);\n      }\n      \n      .select-feature-button {\n        position: fixed;\n        left: 50%;\n        top: 50%;\n        transform: translate(-50%, -50%);\n        z-index: 1000;\n      }\n      \n      .preview-controls {\n        position: fixed;\n        bottom: 2rem;\n        right: 2rem;\n        display: flex;\n        gap: 0.5rem;\n        padding: 1rem;\n        background: white;\n        border-radius: 0.5rem;\n        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n        z-index: 1000;\n      }\n      \n      .editor-container {\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: white;\n        border-radius: 0.5rem;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n        z-index: 2000;\n        width: 500px;\n        height: 600px;\n        display: flex;\n        flex-direction: column;\n        padding: 1.5rem;\n      }\n      \n      .feature-form-container {\n        flex: 1;\n        overflow-y: auto;\n        margin-bottom: 4rem;\n      }\n      \n      .button-container {\n        position: absolute;\n        bottom: 1rem;\n        right: 1rem;\n        display: flex;\n        gap: 0.5rem;\n        padding: 1rem;\n        background-color: white;\n        z-index: 2001;\n      }\n    ")),r)}}function u(e){c.p=e}})(),d})())}}}));